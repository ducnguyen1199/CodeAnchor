# Getting Started with CodeAnchor

This guide will help you set up CodeAnchor in your project and start generating living documentation for your components.

## Prerequisites

Before you begin, ensure you have:
- **Node.js** >= 20.0.0 installed
- A **React**, **Vue**, or **Svelte** project
- **TypeScript** (recommended but not required)
- **Git** for commit hooks (optional but recommended)
- An **Anthropic API key** for AI features (optional)

## Installation

Install CodeAnchor globally:

```bash
npm install -g codeanchor
```

Or install as a dev dependency in your project:

```bash
npm install --save-dev codeanchor
```

## Step 1: Initialize CodeAnchor

Navigate to your project directory and run:

```bash
cd your-project
anchor init
```

The interactive wizard will guide you through setup:

### Tech Stack Detection

CodeAnchor automatically detects your tech stack from `package.json`:

```
üì¶ Detected Stack:
   ‚Ä¢ React
   ‚Ä¢ TypeScript
   ‚Ä¢ TailwindCSS
```

### Project Structure

Choose a structure that matches your project:

```
? Select project structure:
  ‚ùØ Atomic Design (atoms ‚Üí molecules ‚Üí organisms)
    Feature-based (features/Auth, features/Checkout)
    Modular (modules with routes & state)
    Custom (I'll configure manually)
```

**Recommendations:**
- **Atomic Design** - Component libraries, design systems
- **Feature-based** - Next.js, large applications
- **Modular** - Domain-driven projects
- **Custom** - Non-standard structures

### AI Configuration (Optional)

Enable AI-powered documentation:

```
? Enable AI-powered documentation generation? (Y/n)
? Select AI provider: Claude (Anthropic) - Recommended
? Enter API key: [hidden]
```

**Getting an API Key:**
1. Go to https://console.anthropic.com
2. Create an account or sign in
3. Navigate to API Keys
4. Generate a new key
5. Copy and paste into the prompt

**Note:** You can skip AI setup and use template-only mode.

### Git Hooks (Optional)

Install pre-commit hook for automatic doc sync:

```
? Install git pre-commit hook? (fast doc sync on commit) (Y/n)
```

The hook:
- Runs automatically on every commit
- Syncs docs in template-only mode (<2s)
- Never blocks your commit
- Can be uninstalled anytime

### Configuration Created

After setup, `anchor.config.json` is created:

```json
{
  "projectName": "my-app",
  "structure": {
    "type": "atomic",
    "paths": {
      "atoms": "src/components/atoms",
      "molecules": "src/components/molecules",
      "organisms": "src/components/organisms"
    }
  },
  "stack": ["react", "typescript", "tailwindcss"],
  "ai": {
    "provider": "claude",
    "model": "claude-3-5-sonnet-20241022",
    "apiKey": "sk-ant-..."
  },
  "detection": {
    "enabled": true,
    "watchPatterns": ["src/components/**/*.{tsx,ts}"],
    "autoGenerateDocs": true
  },
  "git": {
    "conventionalCommits": true,
    "autoStageDocs": true
  }
}
```

## Step 2: Generate Initial Documentation

Run your first sync:

```bash
anchor sync
```

This will:
1. Find all component files
2. Analyze props and types
3. Generate README.md for each component
4. Use AI to create descriptions (if configured)

**Example output:**
```
‚ú® Syncing documentation...

‚úì Found 15 component files

Syncing components...
  ‚úì Button (1/15)
  ‚úì Input (2/15)
  ‚úì Card (3/15)
  ...

‚úì Synced 15 components (0 errors)

Completed in 4.23s
```

## Step 3: Review Generated Documentation

Check the generated docs:

```bash
# Button component
src/components/atoms/Button/Button.tsx
src/components/atoms/Button/README.md  # ‚Üê Generated!
```

**Example README.md:**

```markdown
# Button

A reusable button component with multiple variants and sizes.

## Props

| Name | Type | Required | Description |
|------|------|----------|-------------|
| variant | "primary" \| "secondary" | No | Button style variant |
| size | "sm" \| "md" \| "lg" | No | Button size |
| disabled | boolean | No | Disable button interaction |
| onClick | () => void | Yes | Click handler function |

## Usage Example

\`\`\`tsx
import { Button } from './Button';

<Button
  variant="primary"
  size="md"
  onClick={() => console.log('clicked')}
>
  Click me
</Button>
\`\`\`
```

## Step 4: Make Changes and Commit

### With Git Hook Installed

Just commit as normal:

```bash
# Make changes to Button.tsx
git add .
git commit -m "feat: add loading state to Button"
```

The pre-commit hook automatically:
- Syncs documentation (template-only, fast)
- Stages updated README.md files
- Never blocks your commit

### Without Git Hook

Manually sync before committing:

```bash
# Make changes
anchor sync --fast
git add .
git commit -m "feat: add loading state to Button"
```

## Step 5: Enrich with AI (Optional)

After committing, enrich docs with AI descriptions:

```bash
anchor enrich
```

This adds detailed descriptions to components:

```markdown
# Button

A versatile button component that supports multiple visual variants,
sizes, and states. Built with accessibility in mind, it handles
keyboard navigation, focus management, and disabled states properly.
```

**Why separate enrichment?**
- Pre-commit stays fast (<2s)
- You control when AI runs
- Review AI output before committing
- No silent failures

## Common Workflows

### Daily Development

```bash
# 1. Make changes to components
# 2. Commit (hook auto-syncs docs)
git commit -m "feat: update Button props"

# 3. Enrich with AI when convenient
anchor enrich

# 4. Review and commit enriched docs
git add .
git commit -m "docs: enrich Button documentation"
```

### Watch Mode (Development)

```bash
# Auto-sync on every file change
anchor watch
```

Leave this running while developing. Docs update automatically.

### Fast Sync (Incremental)

```bash
# Only process changed files
anchor sync --fast
```

Uses cache to skip unchanged components (80% faster).

### Force Regeneration

```bash
# Regenerate all docs (ignore cache)
anchor sync --force
```

Useful after config changes or template updates.

### Template-Only Mode

```bash
# Skip AI, only generate structure
anchor sync --no-ai
anchor watch --no-ai
```

Fastest mode. Great for CI/CD or when AI quota is limited.

### AI Commit Messages

```bash
# Stage your changes
git add .

# Generate semantic commit message
anchor commit
```

AI analyzes your changes and suggests:
```
feat(Button): add loading state prop

- Add isLoading prop to Button interface
- Update button styles for loading state
- Add spinner icon for visual feedback
```

## Configuration Tips

### Environment Variables

Store API keys securely:

```bash
# .env
ANTHROPIC_API_KEY=sk-ant-...

# .env.local (gitignored)
ANTHROPIC_API_KEY=sk-ant-...
```

Remove from `anchor.config.json`:

```json
{
  "ai": {
    "provider": "claude",
    "model": "claude-3-5-sonnet-20241022"
    // apiKey removed - uses ANTHROPIC_API_KEY env var
  }
}
```

### Custom Watch Patterns

```json
{
  "detection": {
    "watchPatterns": [
      "src/components/**/*.{tsx,ts}",
      "src/features/**/components/**/*.{tsx,ts}",
      "packages/ui/src/**/*.{tsx,ts}"
    ],
    "ignore": [
      "**/*.test.{tsx,ts}",
      "**/*.stories.{tsx,ts}",
      "node_modules/**"
    ]
  }
}
```

### Disable Auto-Generation

```json
{
  "detection": {
    "autoGenerateDocs": false  // Manual sync only
  }
}
```

## Troubleshooting

### "No components found"

**Check watch patterns:**
```bash
# Are component files in the configured paths?
cat anchor.config.json | grep watchPatterns
ls -la src/components/
```

### "AI connection failed"

**Verify API key:**
```bash
# Test API key
export ANTHROPIC_API_KEY=sk-ant-...
anchor init  # Re-configure

# Or test connection manually
curl https://api.anthropic.com/v1/messages \
  -H "x-api-key: $ANTHROPIC_API_KEY" \
  -H "anthropic-version: 2023-06-01"
```

### "Pre-commit hook slow"

**Hook should be <2s. If slower:**

1. Check if AI is disabled (should be template-only)
2. Verify cache is working: `.anchor/cache/` directory exists
3. Reduce watch patterns if too many files

```bash
# Debug hook
sh -x .git/hooks/pre-commit
```

### "Cache not working"

**Clear cache and rebuild:**
```bash
rm -rf .anchor/cache/
anchor sync --force
```

### "Permission denied: bin/anchor.js"

**Fix executable permissions:**
```bash
chmod +x node_modules/codeanchor/bin/anchor.js
```

## Next Steps

- Read the [User Guide](./user-guide.md) for detailed documentation
- See [CONTRIBUTING.md](../CONTRIBUTING.md) to contribute
- Join [GitHub Discussions](https://github.com/yourusername/codeanchor/discussions) for support

## Quick Reference

| Command | Description |
|---------|-------------|
| `anchor init` | Initialize CodeAnchor |
| `anchor sync` | Generate/update all docs |
| `anchor sync --fast` | Only changed files |
| `anchor sync --force` | Force regeneration |
| `anchor sync --no-ai` | Template-only mode |
| `anchor watch` | Auto-sync on changes |
| `anchor enrich` | Add AI descriptions |
| `anchor commit` | AI commit message |

---

**Need help?** [Open an issue](https://github.com/yourusername/codeanchor/issues) or [start a discussion](https://github.com/yourusername/codeanchor/discussions).
